<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Registration</title>
    <link rel="stylesheet" th:href="@{/css/register.css}">
    <style>
        .password-container {
            position: relative;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 0.9rem;
            color: #555;
            user-select: none;
        }
    </style>
</head>
<body>
<div class="register-card">
    <h2>Create Account</h2>
    <form th:action="@{/v1/registerNewUser}" th:object="${registerRequest}" th:method="post" onsubmit="return validatePassword()">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" th:field="*{username}" required/>
        </div>

        <div class="form-group password-container">
            <label for="password">Password</label>
            <input type="password" id="password" th:field="*{password}" required/>
            <span class="toggle-password" onclick="togglePassword('password')">Show</span>
            <small id="passwordHelp" style="color: #555;">Password must be 8+ characters, include uppercase, lowercase, number, and special character.</small>
            <div id="passwordError" style="color: red; margin-top: 0.3rem;"></div>
        </div>

        <div class="form-group password-container">
            <label for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" required/>
            <span class="toggle-password" onclick="togglePassword('confirmPassword')">Show</span>
            <div id="confirmPasswordError" style="color: red; margin-top: 0.3rem;"></div>
        </div>

        <button type="submit">Register</button>
    </form>

    <!-- Link to login page -->
    <div class="login-link">
        <p>Already have an account?
            <a th:href="@{/login}">Login here</a>
        </p>
    </div>

    <div th:if="${msg}" class="message" th:classappend="${msgType}">
        <p  th:text="${msg}"></p>
    </div>
</div>

<script>
    function togglePassword(id) {
        const input = document.getElementById(id);
        const toggle = input.nextElementSibling;
        if (input.type === "password") {
            input.type = "text";
            toggle.textContent = "Hide";
        } else {
            input.type = "password";
            toggle.textContent = "Show";
        }
    }

    function validatePassword() {
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;
        const passwordError = document.getElementById("passwordError");
        const confirmPasswordError = document.getElementById("confirmPasswordError");
        const pattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;

        let valid = true;

        if (!pattern.test(password)) {
            passwordError.textContent = "Password must be at least 8 characters long and include uppercase, lowercase, number, and special character.";
            valid = false;
        } else {
            passwordError.textContent = "";
        }

        if (password !== confirmPassword) {
            confirmPasswordError.textContent = "Passwords do not match.";
            valid = false;
        } else {
            confirmPasswordError.textContent = "";
        }

        return valid;
    }
</script>
</body>
</html>
